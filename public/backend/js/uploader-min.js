define("bui/uploader",["bui/common","jquery","bui/list","bui/data","bui/swf"],function(e,t,i){var a=e("bui/common"),n=a.namespace("Uploader");a.mix(n,{Uploader:e("bui/uploader/uploader"),Queue:e("bui/uploader/queue"),Theme:e("bui/uploader/theme"),Factory:e("bui/uploader/factory")}),i.exports=n}),define("bui/uploader/uploader",["jquery","bui/common","bui/list","bui/data","bui/swf"],function(e,t,i){function a(e){return c[e]&&c[e]()}function n(e,t,i){o.isFunction(e.set)?e.set(t,i):e[t]=i}var s=e("jquery"),o=e("bui/common"),r=o.Component,u=e("bui/uploader/file"),l=e("bui/uploader/theme"),d=e("bui/uploader/factory"),p=e("bui/uploader/validator"),c={ajax:function(){return!!window.FormData},flash:function(){return!0},iframe:function(){return!0}},f=r.Controller.extend({initializer:function(){var e=this;e._initTheme(),e._initType()},renderUI:function(){var e=this;e._renderButton(),e._renderUploaderType(),e._renderQueue(),e._initValidator()},bindUI:function(){var e=this;e._bindButton(),e._bindUploaderCore(),e._bindQueue()},_initTheme:function(){var e=this,t=l.getTheme(e.get("theme")),i=e.getAttrVals();o.each(t,function(t,a){void 0===i[a]?e.set(a,t):s.isPlainObject(t)&&(o.mix(t,i[a]),e.set(a,t))})},_initType:function(){var e=this,t=e.get("types"),i=e.get("type");i||o.each(t,function(e){return a(e)?(i=e,!1):void 0}),e.set("type",i)},_initValidator:function(){var e=this,t=e.get("validator");t||(t=new p({queue:e.get("queue"),rules:e.get("rules")}),e.set("validator",t))},_renderUploaderType:function(){var e=this,t=e.get("type"),i=e.get("uploaderType"),a=d.createUploadType(t,i);a.set("uploader",e),e.set("uploaderType",a)},_renderButton:function(){var e=this,t=e.get("type"),i=e.get("el"),a=e.get("button");a.isController||(a.render=i,a.autoRender=!0,a=d.createButton(t,a),e.set("button",a)),a.set("uploader",e)},_renderQueue:function(){var e=this,t=e.get("el"),i=e.get("queue");i.isController||(i.render=t,i.autoRender=!0,i=d.createQueue(i),e.set("queue",i)),i.set("uploader",e)},_bindButton:function(){var e=this,t=e.get("button"),i=e.get("queue");t.on("change",function(t){var a=t.files;e.fire("beforechange",{items:a}),i.addItems(a),e.fire("change",{items:a})})},_bindQueue:function(){var e=this,t=e.get("queue"),i=(e.get("button"),e.get("validator"));t.on("itemrendered",function(a){var n=a.item,s=t.status(n)||"add";n.isUploaderFile||(n.result=o.cloneObject(n),n=u.create(n)),i.valid(n)||(s="error"),t.updateFileStatus(n,s),e.get("autoUpload")&&e.upload()}),t.on("itemupdated",function(t){e.uploadFiles()})},_bindUploaderCore:function(){var e=this,t=e.get("queue"),i=e.get("uploaderType");i.on("start",function(t){var i=t.file;delete i.result,e.fire("start",{item:i})}),i.on("progress",function(i){var a=e.get("curUploadItem"),n=i.loaded,s=i.total;o.mix(a,{total:s,loaded:n,loadedPercent:100*n/s}),t.updateFileStatus(a,"progress"),e.fire("progress",{item:a,total:s,loaded:n})}),i.on("error",function(i){var a=e.get("curUploadItem"),n=e.get("error"),s=e.get("complete");t.updateFileStatus(a,"error"),n&&o.isFunction(n)&&n.call(e),e.fire("error",{item:a}),s&&o.isFunction(s)&&s.call(e),e.fire("complete",{item:a}),e.set("curUploadItem",null)}),i.on("complete",function(i){var a=e.get("curUploadItem"),n=i.result,s=e.get("isSuccess"),r=e.get("success"),u=e.get("error"),l=e.get("complete");e.set("curUploadItem",null),a.result=n,s.call(e,n)?(o.mix(a,n),t.updateFileStatus(a,"success"),r&&o.isFunction(r)&&r.call(e,n),e.fire("success",{item:a,result:n})):(t.updateFileStatus(a,"error"),u&&o.isFunction(u)&&u.call(e,n),e.fire("error",{item:a,result:n})),l&&o.isFunction(l)&&l.call(e,n),e.fire("complete",{item:a,result:n})})},uploadFile:function(e){var t=this,i=t.get("queue"),a=t.get("uploaderType"),n=t.get("curUploadItem");e&&!n&&(t.set("curUploadItem",e),i.updateFileStatus(e,"start"),a.upload(e))},uploadFiles:function(){var e=this,t=e.get("queue"),i=t.getItemsByStatus("wait");i&&i.length&&e.uploadFile(i[0])},upload:function(){var e=this,t=e.get("queue"),i=t.getItemsByStatus("add");o.each(i,function(e){t.updateFileStatus(e,"wait")})},cancel:function(e){var t=this;return e?void t._cancel(e):void o.each(t.get("queue").getItemsByStatus("wait"),function(e){t._cancel(e)})},_cancel:function(e){var t=this,i=t.get("queue"),a=t.get("uploaderType"),n=t.get("curUploadItem");n===e&&(a.cancel(),t.set("curUploadItem",null)),i.updateFileStatus(e,"cancel"),t.fire("cancel",{item:e})},isValid:function(){var e=this,t=e.get("queue");return t.getItemsByStatus("success").length===t.getItems().length}},{ATTRS:{types:{value:["ajax","flash","iframe"]},type:{},theme:{value:"default"},button:{value:{},shared:!1},text:{setter:function(e){return n(this.get("button"),"text",e),e}},name:{setter:function(e){return n(this.get("button"),"name",e),n(this.get("uploaderType"),"fileDataName",e),e}},disabled:{value:!1,setter:function(e){return n(this.get("button"),"disabled",e),e}},multiple:{value:!0,setter:function(e){return n(this.get("button"),"multiple",e),e}},filter:{setter:function(e){return n(this.get("button"),"filter",e),e}},uploaderType:{value:{},shared:!1},url:{setter:function(e){return n(this.get("uploaderType"),"url",e),e}},data:{setter:function(e){return n(this.get("uploaderType"),"data",e),e}},queue:{value:{},shared:!1},resultTpl:{setter:function(e){return n(this.get("queue"),"resultTpl",e),e}},autoUpload:{value:!0},uploadStatus:{},isSuccess:{value:function(e){return e&&e.url?!0:!1}},validator:{},events:{value:{change:!1,start:!1,progress:!1,success:!1,error:!1,complete:!1,cancel:!1}}}},{xclass:"uploader"});i.exports=f}),define("bui/uploader/file",["bui/common","jquery"],function(e,t,i){function a(e){return e.replace(/.*(\/|\\)/,"")}function n(e){var t=/\.[^\.]+$/.exec(e)||[];return t.join("").toLowerCase()}function s(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["KB","MB","GB","TB","PB","EB"][t]}var o=e("bui/common");i.exports={create:function(e){return e.id=e.id||o.guid("bui-uploader-file"),e.name=a(e.name),e.ext=n(e.name),e.textSize=s(e.size),e.isUploaderFile=!0,e}}}),define("bui/uploader/theme",["bui/common","jquery"],function(e,t,i){var a=e("bui/common"),n={},s={addTheme:function(e,t){n[e]=t},getTheme:function(e){return a.cloneObject(n[e])}};s.addTheme("default",{elCls:"defaultTheme"}),s.addTheme("imageView",{elCls:"imageViewTheme",queue:{resultTpl:{success:'<div class="success"><img src="{url}" /></div>'}}}),i.exports=s}),define("bui/uploader/factory",["bui/common","jquery","bui/list","bui/data","bui/swf"],function(e,t,i){function a(){}var n=(e("bui/common"),e("bui/uploader/queue")),s=e("bui/uploader/button/htmlButton"),o=e("bui/uploader/button/swfButton"),r=e("bui/uploader/type/ajax"),u=e("bui/uploader/type/flash"),l=e("bui/uploader/type/iframe"),d=e("bui/uploader/button/uploadify"),p=e("bui/uploader/type/uploadify");a.prototype={createUploadType:function(e,t){return"ajax"===e?new r(t):"flash"===e?new u(t):"uploadify"===e?new p(t):new l(t)},createButton:function(e,t){return"ajax"===e||"iframe"===e?new s(t):"uploadify"===e?new d(t):new o(t)},createQueue:function(e){return new n(e)}},i.exports=new a}),define("bui/uploader/queue",["jquery","bui/common","bui/list","bui/data"],function(e,t,i){var a=e("jquery"),n=e("bui/common"),s=e("bui/list").SimpleList,o=n.prefix+"queue",r=o+"-item",u=s.extend({bindUI:function(){var e=this,t=e.get("el"),i=e.get("delCls");t.delegate("."+i,"click",function(t){var i=a(t.target).parents(".bui-queue-item"),n=e.getItemByElement(i);e.fire("beforeremove",{item:n,target:t.target})!==!1&&e.removeItem(n)})},removeItem:function(e){var t=this,i=t.get("uploader");i&&i.cancel&&i.cancel(e),u.superclass.removeItem.call(t,e)},updateFileStatus:function(e,t,i){var a=this,s=a.get("itemStatusFields");i=i||a.findElement(e),n.each(s,function(t,n){a.setItemStatus(e,n,!1,i)}),a.setItemStatus(e,t,!0,i),a._setResultTpl(e,t),a.updateItem(e)},_setResultTpl:function(e,t){var i=this,a=i.get("resultTpl"),s=a[t]||a["default"],o=n.mix(e,e.result);e.resultTpl=n.substitute(s,o)},status:function(e){var t,i=this,a=i.get("itemStatusFields");return n.each(a,function(i,a){return e[i]?(t=i,!1):void 0}),t}},{ATTRS:{itemTpl:{value:'<li>{resultTpl} <span class="action"><span class="'+r+'-del">\u5220\u9664</span></span></li>'},resultTpl:{value:{"default":'<div class="default">{name}</div>',success:'<div data-url="{url}" class="success">{name}</div>',error:'<div class="error"><span title="{name}">{name}</span><span class="uploader-error">{msg}</span></div>',progress:'<div class="progress"><div class="bar" style="width:{loadedPercent}%"></div></div>'},setter:function(e){return n.mix({},this.get("resultTpl"),e)}},itemCls:{value:r},delCls:{value:r+"-del"},itemStatusFields:{value:{add:"add",wait:"wait",start:"start",progress:"progress",success:"success",cancel:"cancel",error:"error"}}}},{xclass:"queue"});i.exports=u}),define("bui/uploader/button/htmlButton",["jquery","bui/common"],function(e,t,i){var a=e("jquery"),n=e("bui/common"),s=(n.Component,e("bui/uploader/file")),o=e("bui/uploader/button/base"),r=n.UA,u=o.extend({renderUI:function(){var e=this;e._createInput()},_createInput:function(){var e,t=this,i=t.get("buttonCls"),a=t.get("el").find("."+i),s=t.get("inputTpl"),o=t.get("name");s=n.substitute(s,{name:o}),a.append(s),e=a.find("input"),6==r.ie&&e.css("fontSize","400px"),t._bindChangeHandler(e),t.set("fileInput",e),t._uiSetMultiple(t.get("multiple")),t._uiSetDisabled(t.get("disabled")),t._uiSetFilter(t.get("filter"))},_bindChangeHandler:function(e){var t=this;a(e).on("change",function(i){var o=a(this).val(),r=i.target.files,u=[];r?n.each(r,function(t){u.push(s.create({name:t.name,type:t.type,size:t.size,file:t,input:e}))}):u.push(s.create({name:o,input:e})),t.fire("change",{files:u,input:this}),t.reset()})},reset:function(){var e=this,t=e.get("fileInput");return t.parent().remove(),e.set("fileInput",null),e._createInput(),e},_uiSetMultiple:function(e){var t=this,i=t.get("fileInput");return i&&i.length?(e?i.attr("multiple","multiple"):i.removeAttr("multiple"),e):!1},_uiSetDisabled:function(e){var t=this,i=t.get("fileInput");e?i.hide():i.show()},_uiSetFilter:function(e){var t=this,i=t.get("fileInput"),a=t.getFilter(e);return i&&i.length?(a.type&&i.attr("accept",a.type),a):!1},_uiSetName:function(e){a(this.get("fileInput")).attr("name",e)}},{ATTRS:{inputTpl:{view:!0,value:'<div class="file-input-wrapper"><input type="file" name="{name}" hidefocus="true" class="file-input" /></div>'},fileInput:{}}},{xclass:"uploader-htmlButton"});i.exports=u}),define("bui/uploader/button/base",["bui/common","jquery"],function(e,t,i){var a=e("bui/common"),n=a.Component,s=e("bui/uploader/button/filter"),o=a.prefix,r=o+"uploader",u=r+"-button",l=u+"-text",d=n.View.extend({_uiSetText:function(e){var t=this,i=t.get("text"),a=t.get("textCls"),n=t.get("el").find("."+a);n.text(i)}},{ATTRS:{}},{xclass:"uploader-button-view"}),p=n.Controller.extend({getFilter:function(e){if(e){var t=[],i=[],a=[];return e.desc&&(t.push(e.desc),i.push(s.getExtByDesc(e.desc)),a.push(s.getTypeByDesc(e.desc))),e.ext&&(i.push(e.ext),a.push(s.getTypeByExt(e.ext))),e.type,{desc:t.join(","),ext:i.join(","),type:a.join(",")}}}},{ATTRS:{buttonCls:{value:u+"-wrap",view:!0},textCls:{value:l,view:!0},text:{view:!0,value:"\u4e0a\u4f20\u6587\u4ef6"},name:{value:"fileData"},tpl:{view:!0,value:'<a href="javascript:void(0);" class="'+u+'-wrap"><span class="'+l+'">{text}</span></a>'},disabled:{value:!1},multiple:{value:!0},filter:{shared:!1,value:[]},events:{value:{change:!1}},xview:{value:d}}},{xclass:"uploader-button"});p.View=d,i.exports=p}),define("bui/uploader/button/filter",["bui/common","jquery"],function(e,t,i){var a=e("bui/common"),n={msexcel:{type:"application/msexcel",ext:".xls,.xlsx"},msword:{type:"application/msword",ext:".doc,.docx"},gif:{type:"image/gif",ext:".gif"},jpeg:{type:"image/jpeg",ext:".jpg"},bmp:{type:"image/x-ms-bmp",ext:".bmp"},png:{type:"image/png",ext:".png"}};i.exports={_getValueByDesc:function(e,t){var i=[];return a.isString(e)&&(e=e.split(",")),a.isArray(e)&&a.each(e,function(e,a){var s=n[e];s&&s[t]&&i.push(s[t])}),i.join(",")},getTypeByDesc:function(e){return this._getValueByDesc(e,"type")},getExtByDesc:function(e){return this._getValueByDesc(e,"ext")},getTypeByExt:function(e){var t=[];return a.isString(e)&&(e=e.split(",")),a.isArray(e)&&a.each(e,function(e){a.each(n,function(i,n){a.Array.indexOf(e,i.ext.split(","))>-1&&t.push(i.type)})}),t.join(",")}}}),define("bui/uploader/button/swfButton",["jquery","bui/common","bui/swf"],function(e,t,i){function a(){if(window.seajs){if(seajs.pluginSDK&&seajs.pluginSDK.util&&seajs.pluginSDK.util.loaderDir)return seajs.pluginSDK.util.loaderDir;var e=seajs.data.paths||{};return e.bui||seajs.data.base}return window.KISSY?KISSY.Config.packages.bui.base:void 0}var n=e("jquery"),s=e("bui/common"),o=(s.Component,e("bui/uploader/file")),r=e("bui/uploader/button/base"),u=a(),l=e("bui/uploader/button/ajbridge"),d=r.extend({renderUI:function(){var e=this;e._initSwfUploader()},bindUI:function(){var e=this,t=e.get("swfUploader");t.on("contentReady",function(i){e.fire("swfReady",{swfUploader:t}),t.on("fileSelect",function(t){var i=t.fileList,a=[];s.each(i,function(e){a.push(o.create(e))}),e.fire("change",{files:a})})})},syncUI:function(){var e=this,t=e.get("swfUploader");t.on("contentReady",function(t){e._uiSetMultiple(e.get("multiple")),e._uiSetFilter(e.get("filter"))})},_initSwfUploader:function(){var e,t=this,i=t.get("buttonCls"),a=t.get("el").find("."+i),o=t.get("flash"),r=t.get("flashUrl"),u=t.get("swfTpl"),d=n(u).appendTo(a);s.mix(o,{render:d,src:r}),e=new l(o),t.set("swfEl",d),t.set("swfUploader",e)},_uiSetMultiple:function(e){var t=this,i=t.get("swfUploader");return i&&i.multifile(e),e},_uiSetDisabled:function(e){var t=this,i=t.get("swfEl");return e?i.hide():i.show(),e},_convertFilter:function(e){var t=(e.desc,[]);return s.each(e.ext.split(","),function(e){e&&t.push("*"+e)}),e.ext=t.join(";"),e},_uiSetFilter:function(e){var t=this,i=t.get("swfUploader"),a=t._convertFilter(t.getFilter(e));return i&&i.filter([a]),e}},{ATTRS:{swfEl:{},swfUploader:{},flashUrl:{value:u+"/uploader.swf"},flash:{value:{params:{allowscriptaccess:"always",bgcolor:"#fff",wmode:"transparent",flashvars:{hand:!0,btn:!0,jsEntry:"BUI.AJBridge.eventHandler"}}},shared:!1},swfTpl:{view:!0,value:'<div class="uploader-button-swf"></div>'}}},{xclass:"uploader-swfButton"});i.exports=d}),define("bui/uploader/button/ajbridge",["bui/common","jquery","bui/swf"],function(e,t,i){function a(e){a.superclass.constructor.call(this,e)}var n=e("bui/common"),s=e("bui/swf"),o={};n.mix(a,{eventHandler:function(e,t){var i=o[e];i&&i.__eventHandler(e,t)},augment:function(e,t){n.isString(t)&&(t=[t]),n.isArray(t)&&n.each(t,function(t){e.prototype[t]=function(){try{return this.callSWF(t,Array.prototype.slice.call(arguments,0))}catch(e){this.fire("error",{message:e})}}})}}),n.extend(a,s),n.augment(a,{initializer:function(){a.superclass.initializer.call(this);var e=this,t=e.get("attrs"),i=t.id;o[i]=e,e.set("id",i)},__eventHandler:function(e,t){var i=this,a=t.type;switch(t.id=e,a){case"log":n.log(t.message);break;default:i.fire(a,t)}},destroy:function(){a.superclass.destroy.call(this);var e=this.get("id");o[e]&&delete o[e]}}),a.augment(a,["activate","getReady","getCoreVersion","setFileFilters","filter","setAllowMultipleFiles","multifile","browse","upload","uploadAll","cancel","getFile","removeFile","lock","unlock","setBtnMode","useHand","clear"]),n.AJBridge=a,i.exports=a}),define("bui/uploader/type/ajax",["bui/common","jquery"],function(e,t,i){function a(e){var t=this;a.superclass.constructor.call(t,e)}var n="[uploader-Ajax]:",s=e("bui/uploader/type/base");BUI.extend(a,s,{upload:function(e){if(!e||!e.file)return BUI.log(n+"upload()\uff0cfileData\u53c2\u6570\u6709\u8bef\uff01"),!1;var t=this;return t.set("file",e),t.fire("start",{file:e}),t._setFormData(),t._addFileData(e.file),t.send(),t},cancel:function(){var e=this,t=e.get("xhr"),i=e.get("file");return t&&(t.abort(),e.fire("cancel",{file:i})),e.set("file",null),e},send:function(){var e=this,t=e.get("url"),i=e.get("formData"),a=e.get("file"),n=new XMLHttpRequest;return n.upload.addEventListener("progress",function(t){e.fire("progress",{loaded:t.loaded,total:t.total})}),n.onload=function(t){var i=e._processResponse(n.responseText);e.fire("complete",{result:i,file:a})},n.onerror=function(t){e.fire("error",{file:a})},n.open("POST",t,!0),n.send(i),e._setFormData(),e.set("xhr",n),e},reset:function(){},_setFormData:function(){var e=this;try{e.set("formData",new FormData),e._processData()}catch(t){BUI.log(n+"something error when reset FormData."),BUI.log(t,"dir")}},_processData:function(){var e=this,t=e.get("data"),i=e.get("formData");BUI.each(t,function(e,t){i.append(t,e)}),e.set("formData",i)},_addFileData:function(e){if(!e)return BUI.log(n+"_addFileData()\uff0cfile\u53c2\u6570\u6709\u8bef\uff01"),!1;var t=this,i=t.get("formData"),a=t.get("fileDataName");i.append(a,e),t.set("formData",i)}},{ATTRS:{formData:{},xhr:{},events:{value:{progress:!1}}}}),i.exports=a}),define("bui/uploader/type/base",["bui/common","jquery"],function(e,t,i){function a(e){var t=this;a.superclass.constructor.call(t,e)}var n=e("bui/common");a.ATTRS={file:{},url:{},data:{},fileDataName:{value:"Filedata"},events:{value:{start:!1,cancel:!1,success:!1,error:!1}}},n.extend(a,n.Base,{upload:function(e){},cancel:function(){},_processResponse:function(e){var t,i=this;i.get("file");if(n.isString(e))try{t=n.JSON.parse(e)}catch(a){t=e}else n.isObject(e)&&(t=i._fromUnicode(e));return n.log("\u670d\u52a1\u5668\u7aef\u8f93\u51fa\uff1a"+n.JSON.stringify(t)),t},_fromUnicode:function(e){function t(e){n.each(e,function(i,a){n.isObject(e[a])?t(e[a]):e[a]=n.isString(i)&&n.fromUnicode(i)||i})}return n.isObject(e)?(t(e),e):e},reset:function(){}}),i.exports=a}),define("bui/uploader/type/flash",["jquery","bui/common"],function(e,t,i){function a(e){var t=this;a.superclass.constructor.call(t,e)}var n=e("jquery"),s=e("bui/uploader/type/base"),o="[uploader-Flash]:",r=new RegExp("^([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),u=new RegExp("^(?:([\\w\\d+.-]+):)?(?://([\\w\\d\\-\\u0100-\\uffff.+%]*))?.*$");BUI.extend(a,s,{_initSwfUploader:function(){var e=this,t=e.get("swfUploader");return t?(e.fire("swfReady"),e._hasCrossdomain(),t.on("uploadStart",function(t){var i=e.get("file");e.fire("start",{file:i})}),t.on("uploadProgress",function(t){BUI.mix(t,{loaded:t.bytesLoaded,total:t.bytesTotal}),BUI.log(o+"\u5df2\u7ecf\u4e0a\u4f20\u5b57\u8282\u6570\u4e3a\uff1a"+t.bytesLoaded),e.fire("progress",{loaded:t.loaded,total:t.total})}),t.on("uploadCompleteData",function(t){var i=e.get("file"),a=e._processResponse(t.data);e.fire("complete",{result:a,file:i}),e.set("file",null)}),void t.on("uploadError",function(){var t=e.get("file");e.fire("error",{file:t}),e.set("file",null)})):(BUI.log(o+"swfUploader\u5bf9\u8c61\u4e3a\u7a7a\uff01"),!1)},upload:function(e){var t=this,i=t.get("swfUploader"),a=t.get("url"),n="POST",s=t.get("data"),o=t.get("fileDataName");if(e)return t.set("file",e),i.upload(e.id,a,n,s,o),t},cancel:function(){var e=this,t=e.get("swfUploader"),i=e.get("file");return i&&(t.cancel(i.id),e.fire("cancel",{file:i}),e.set("file",null)),e},_hasCrossdomain:function(){var e=this,t=e.get("url").match(u)||[],i=e.get("swfUploader").get("src").match(u)||[],a=t[2],s=i[2];a&&s&&a!==s&&n.ajax({url:t[1]+"://"+a+"/crossdomain.xml",dataType:"xml",error:function(){BUI.log("\u7f3a\u5c11crossdomain.xml\u6587\u4ef6\u6216\u8be5\u6587\u4ef6\u4e0d\u5408\u6cd5\uff01")}})}},{ATTRS:{uploader:{setter:function(e){var t=this;if(e&&e.isController){var i=e.get("button");i.on("swfReady",function(e){t.set("swfUploader",e.swfUploader),t._initSwfUploader()})}}},url:{setter:function(e){var t=/^http/;if(!t.test(e)){var i,a=location.href.match(r)||[],n=a[1]||"",s=n.split("/");i=BUI.Array.filter(s,function(e,t){return t<s.length-1}),e=i.join("/")+"/"+e}return e}},swfUploader:{},uploadingId:{},events:{value:{swfReady:!1,progress:!1}}}}),i.exports=a}),define("bui/uploader/type/iframe",["jquery","bui/common"],function(e,t,i){function a(e){var t=this;a.superclass.constructor.call(t,e)}var n=e("jquery"),s=e("bui/uploader/type/base"),o="bui-uploader-iframe-";BUI.extend(a,s,{upload:function(e){var t,i=this,a=e.input;return e?(i.fire("start",{file:e}),i.set("file",e),i.set("fileInput",a),i._create(),t=i.get("form"),void(t&&t[0].submit())):!1},cancel:function(){var e=this;e.get("iframe");return e.reset(),e.fire("cancel"),e},dataToHidden:function(e){if(!n.isPlainObject(e)||n.isEmptyObject(e))return"";var t=this,i=[],a=t.get("tpl"),s=a.HIDDEN_INPUT;if(!BUI.isString(s))return"";for(var o in e)i.push(BUI.substitute(s,{name:o,value:e[o]}));return i.join()},_createIframe:function(){var e,t=this,i=o+BUI.guid(),a=t.get("tpl"),s=(a.IFRAME,t.get("iframe"));return n.isEmptyObject(s)?(e=n(BUI.substitute(a.IFRAME,{id:i})),n("body").append(e),e.on("load",function(e){t._iframeLoadHandler(e)}),t.set("id",i),t.set("iframe",e),e):s},_iframeLoadHandler:function(e){var t,i=this,a=e.target,n=a.contentDocument||window.frames[a.id].document;if(!n||!n.body)return i.fire("error",{msg:"\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u6709\u95ee\u9898\uff01"}),!1;var s=n.body.innerHTML;return""==s?void i.fire("error"):(t=i._processResponse(s),i.fire("complete",{result:t,file:i.get("file")}),void i.reset())},_createForm:function(){var e,t,i=this,a=i.get("id"),s=i.get("tpl"),o=s.FORM,r=i.get("data"),u=i.get("url"),l=i.get("fileInput");return BUI.isString(o)&&BUI.isString(u)?(e=i.dataToHidden(r),e+=i.dataToHidden({type:"iframe"}),t=BUI.substitute(o,{action:u,target:a,hiddenInputs:e}),t=n(t).append(l),n("body").append(t),i.set("form",t),t):!1},_create:function(){var e=this,t=e._createIframe(),i=e._createForm();e.fire("create",{iframe:t,form:i})},_remove:function(){var e=this,t=e.get("form");return t?(t.remove(),e.set("form",null),void e.fire("remove",{form:t})):!1},reset:function(){var e=this;e._remove(),e.set("file",null)}},{ATTRS:{tpl:{value:{IFRAME:'<iframe src="javascript:false;" name="{id}" id="{id}" border="no" width="1" height="1" style="display: none;" />',FORM:'<form method="post" enctype="multipart/form-data" action="{action}" target="{target}" style="visibility: hidden;">{hiddenInputs}</form>',HIDDEN_INPUT:'<input type="hidden" name="{name}" value="{value}" />'}},id:{value:o+BUI.guid()},iframe:{value:{}},form:{},fileInput:{},events:{value:{create:!1,remove:!1}}}}),i.exports=a}),define("bui/uploader/button/uploadify",["jquery","bui/common"],function(e,t,i){function a(){if(window.seajs){if(seajs.pluginSDK&&seajs.pluginSDK.util&&seajs.pluginSDK.util.loaderDir)return seajs.pluginSDK.util.loaderDir;var e=seajs.data.paths||{};return e.bui||seajs.data.base}return window.KISSY?KISSY.Config.packages.bui.base:void 0}var n=e("jquery"),s=e("bui/common"),o=(s.Component,e("bui/uploader/file"),e("bui/uploader/button/base")),r=a(),u=(e("bui/uploader/plugins/uploadify"),o.extend({renderUI:function(){var e=this,t=e.get("buttonCls"),i=e.get("el").find("."+t),a=(e.get("flash"),e.get("flashUrl"),e.get("swfTpl")),o=n(a).appendTo(i),r=o.find("input"),u=(e.get("uploader"),e.get("name"));r.attr("name",u),r.attr("id",s.guid("bui-uploadify")),e.set("uploadifyEl",r)}},{ATTRS:{name:{},uploader:{},swfEl:{},flashUrl:{value:r+"/uploadify.swf"},swfTpl:{view:!0,value:'<div class="uploader-button-swf"><input type="file"/></div>'}}},{xclass:"uploader-uploadify"}));i.exports=u}),define("bui/uploader/plugins/uploadify",["jquery"],function(require,exports,module){var swfobject=function(){function e(){if(!k){try{var e=A.getElementsByTagName("body")[0].appendChild(g("span"));e.parentNode.removeChild(e)}catch(t){return}k=!0;for(var i=j.length,a=0;i>a;a++)j[a]()}}function t(e){k?e():j[j.length]=e}function i(e){if(typeof W.addEventListener!=T)W.addEventListener("load",e,!1);else if(typeof A.addEventListener!=T)A.addEventListener("load",e,!1);else if(typeof W.attachEvent!=T)v(W,"onload",e);else if("function"==typeof W.onload){var t=W.onload;W.onload=function(){t(),e()}}else W.onload=e}function a(){P?n():s()}function n(){var e=A.getElementsByTagName("body")[0],t=g(q);t.setAttribute("type",C);var i=e.appendChild(t);if(i){var a=0;!function(){if(typeof i.GetVariable!=T){var n=i.GetVariable("$version");n&&(n=n.split(" ")[1].split(","),H.pv=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)])}else if(10>a)return a++,void setTimeout(arguments.callee,10);e.removeChild(t),i=null,s()}()}else s()}function s(){var e=N.length;if(e>0)for(var t=0;e>t;t++){var i=N[t].id,a=N[t].callbackFn,n={success:!1,id:i};if(H.pv[0]>0){var s=m(i);if(s)if(!_(N[t].swfVersion)||H.wk&&H.wk<312)if(N[t].expressInstall&&r()){var d={};d.data=N[t].expressInstall,d.width=s.getAttribute("width")||"0",d.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(d.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(d.align=s.getAttribute("align"));for(var p={},c=s.getElementsByTagName("param"),f=c.length,h=0;f>h;h++)"movie"!=c[h].getAttribute("name").toLowerCase()&&(p[c[h].getAttribute("name")]=c[h].getAttribute("value"));u(d,p,i,a)}else l(s),a&&a(n);else b(i,!0),a&&(n.success=!0,n.ref=o(i),a(n))}else if(b(i,!0),a){var g=o(i);g&&typeof g.SetVariable!=T&&(n.success=!0,n.ref=g),a(n)}}}function o(e){var t=null,i=m(e);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=T)t=i;else{var a=i.getElementsByTagName(q)[0];a&&(t=a)}return t}function r(){return!Q&&_("6.0.65")&&(H.win||H.mac)&&!(H.wk&&H.wk<312)}function u(e,t,i,a){Q=!0,E=a||null,D={success:!1,id:i};var n=m(i);if(n){"OBJECT"==n.nodeName?(U=d(n),F=null):(U=n,F=i),e.id=L,(typeof e.width==T||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==T||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),A.title=A.title.slice(0,47)+" - Flash Player Installation";var s=H.ie&&H.win?"ActiveX":"PlugIn",o="MMredirectURL="+W.location.toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+A.title;if(typeof t.flashvars!=T?t.flashvars+="&"+o:t.flashvars=o,H.ie&&H.win&&4!=n.readyState){var r=g("div");i+="SWFObjectNew",r.setAttribute("id",i),n.parentNode.insertBefore(r,n),n.style.display="none",function(){4==n.readyState?n.parentNode.removeChild(n):setTimeout(arguments.callee,10)}()}p(e,t,i)}}function l(e){if(H.ie&&H.win&&4!=e.readyState){var t=g("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(d(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=g("div");if(H.win&&H.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(q)[0];if(i){var a=i.childNodes;if(a)for(var n=a.length,s=0;n>s;s++)1==a[s].nodeType&&"PARAM"==a[s].nodeName||8==a[s].nodeType||t.appendChild(a[s].cloneNode(!0))}}return t}function p(e,t,i){var a,n=m(i);if(H.wk&&H.wk<312)return a;if(n)if(typeof e.id==T&&(e.id=i),H.ie&&H.win){var s="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?t.movie=e[o]:"styleclass"==o.toLowerCase()?s+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(s+=" "+o+'="'+e[o]+'"'));var r="";for(var u in t)t[u]!=Object.prototype[u]&&(r+='<param name="'+u+'" value="'+t[u]+'" />');n.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+r+"</object>",$[$.length]=e.id,a=m(e.id)}else{var l=g(q);l.setAttribute("type",C);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?l.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&l.setAttribute(d,e[d]));for(var p in t)t[p]!=Object.prototype[p]&&"movie"!=p.toLowerCase()&&c(l,p,t[p]);n.parentNode.replaceChild(l,n),a=l}return a}function c(e,t,i){var a=g("param");a.setAttribute("name",t),a.setAttribute("value",i),e.appendChild(a)}function f(e){var t=m(e);t&&"OBJECT"==t.nodeName&&(H.ie&&H.win?(t.style.display="none",function(){4==t.readyState?h(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function h(e){var t=m(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}function m(e){var t=null;try{t=A.getElementById(e)}catch(i){}return t}function g(e){return A.createElement(e)}function v(e,t,i){e.attachEvent(t,i),M[M.length]=[e,t,i]}function _(e){var t=H.pv,i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]?!0:!1}function y(e,t,i,a){if(!H.ie||!H.mac){var n=A.getElementsByTagName("head")[0];if(n){var s=i&&"string"==typeof i?i:"screen";if(a&&(w=null,I=null),!w||I!=s){var o=g("style");o.setAttribute("type","text/css"),o.setAttribute("media",s),w=n.appendChild(o),H.ie&&H.win&&typeof A.styleSheets!=T&&A.styleSheets.length>0&&(w=A.styleSheets[A.styleSheets.length-1]),I=s}H.ie&&H.win?w&&typeof w.addRule==q&&w.addRule(e,t):w&&typeof A.createTextNode!=T&&w.appendChild(A.createTextNode(e+" {"+t+"}"))}}}function b(e,t){if(z){var i=t?"visible":"hidden";k&&m(e)?m(e).style.visibility=i:y("#"+e,"visibility:"+i)}}function S(e){var t=/[\\\"<>\.;]/,i=null!=t.exec(e);return i&&typeof encodeURIComponent!=T?encodeURIComponent(e):e}var U,F,E,D,w,I,T="undefined",q="object",R="Shockwave Flash",x="ShockwaveFlash.ShockwaveFlash",C="application/x-shockwave-flash",L="SWFObjectExprInst",O="onreadystatechange",W=window,A=document,B=navigator,P=!1,j=[a],N=[],$=[],M=[],k=!1,Q=!1,z=!0,H=function(){var e=typeof A.getElementById!=T&&typeof A.getElementsByTagName!=T&&typeof A.createElement!=T,t=B.userAgent.toLowerCase(),i=B.platform.toLowerCase(),a=i?/win/.test(i):/win/.test(t),n=i?/mac/.test(i):/mac/.test(t),s=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,o=!1,r=[0,0,0],u=null;if(typeof B.plugins!=T&&typeof B.plugins[R]==q)u=B.plugins[R].description,!u||typeof B.mimeTypes!=T&&B.mimeTypes[C]&&!B.mimeTypes[C].enabledPlugin||(P=!0,o=!1,u=u.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),r[0]=parseInt(u.replace(/^(.*)\..*$/,"$1"),10),r[1]=parseInt(u.replace(/^.*\.(.*)\s.*$/,"$1"),10),r[2]=/[a-zA-Z]/.test(u)?parseInt(u.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof W.ActiveXObject!=T)try{var l=new ActiveXObject(x);l&&(u=l.GetVariable("$version"),u&&(o=!0,u=u.split(" ")[1].split(","),r=[parseInt(u[0],10),parseInt(u[1],10),parseInt(u[2],10)]))}catch(d){}return{w3:e,pv:r,wk:s,ie:o,win:a,mac:n}}();(function(){H.w3&&((typeof A.readyState!=T&&"complete"==A.readyState||typeof A.readyState==T&&(A.getElementsByTagName("body")[0]||A.body))&&e(),k||(typeof A.addEventListener!=T&&A.addEventListener("DOMContentLoaded",e,!1),H.ie&&H.win&&(A.attachEvent(O,function(){"complete"==A.readyState&&(A.detachEvent(O,arguments.callee),e())}),W==top&&!function(){if(!k){try{A.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),H.wk&&!function(){return k?void 0:/loaded|complete/.test(A.readyState)?void e():void setTimeout(arguments.callee,0)}(),i(e)))})(),function(){H.ie&&H.win&&window.attachEvent("onunload",function(){for(var e=M.length,t=0;e>t;t++)M[t][0].detachEvent(M[t][1],M[t][2]);for(var i=$.length,a=0;i>a;a++)f($[a]);for(var n in H)H[n]=null;H=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,i,a){if(H.w3&&e&&t){var n={};n.id=e,n.swfVersion=t,n.expressInstall=i,n.callbackFn=a,N[N.length]=n,b(e,!1)}else a&&a({success:!1,id:e})},getObjectById:function(e){return H.w3?o(e):void 0},embedSWF:function(e,i,a,n,s,o,l,d,c,f){var h={success:!1,id:i};H.w3&&!(H.wk&&H.wk<312)&&e&&i&&a&&n&&s?(b(i,!1),t(function(){a+="",n+="";var t={};if(c&&typeof c===q)for(var m in c)t[m]=c[m];t.data=e,t.width=a,t.height=n;var g={};if(d&&typeof d===q)for(var v in d)g[v]=d[v];if(l&&typeof l===q)for(var y in l)typeof g.flashvars!=T?g.flashvars+="&"+y+"="+l[y]:g.flashvars=y+"="+l[y];if(_(s)){var S=p(t,g,i);t.id==i&&b(i,!0),h.success=!0,h.ref=S}else{if(o&&r())return t.data=o,void u(t,g,i,f);b(i,!0)}f&&f(h)})):f&&f(h)},switchOffAutoHideShow:function(){z=!1},ua:H,getFlashPlayerVersion:function(){return{major:H.pv[0],minor:H.pv[1],release:H.pv[2]}},hasFlashPlayerVersion:_,
    createSWF:function(e,t,i){return H.w3?p(e,t,i):void 0},showExpressInstall:function(e,t,i,a){H.w3&&r()&&u(e,t,i,a)},removeSWF:function(e){H.w3&&f(e)},createCSS:function(e,t,i,a){H.w3&&y(e,t,i,a)},addDomLoadEvent:t,addLoadEvent:i,getQueryParamValue:function(e){var t=A.location.search||A.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return S(t);for(var i=t.split("&"),a=0;a<i.length;a++)if(i[a].substring(0,i[a].indexOf("="))==e)return S(i[a].substring(i[a].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Q){var e=m(L);e&&U&&(e.parentNode.replaceChild(U,e),F&&(b(F,!0),H.ie&&H.win&&(U.style.display="block")),E&&E(D)),Q=!1}}}}(),SWFUpload;void 0==SWFUpload&&(SWFUpload=function(e){this.initSWFUpload(e)}),SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={},this.settings=e,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(t){throw delete SWFUpload.instances[this.movieName],t}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(e){if("string"!=typeof e||e.match(/^https?:\/\//i)||e.match(/^\//))return e;var t=(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),window.location.pathname.lastIndexOf("/"));return 0>=t?path="/":path=window.location.pathname.substr(0,t)+"/",path+e},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(e,t){this.settings[e]=void 0==this.settings[e]?t:this.settings[e]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var e,t;if(null!==document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";if(e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder,void 0==e)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;t=document.createElement("div"),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),void 0==window[this.movieName]&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString(),t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){if(void 0==this.movieElement&&(this.movieElement=document.getElementById(this.movieName)),null===this.movieElement)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params,t=[];if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i.toString())+"="+encodeURIComponent(e[i].toString()));return t.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var e=null;if(e=this.getMovieElement(),e&&"unknown"==typeof e.CallFunction){for(var t in e)try{"function"==typeof e[t]&&(e[t]=null)}catch(i){}try{e.parentNode.removeChild(e)}catch(a){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(n){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",("function"==typeof this.settings.swfupload_loaded_handler).toString(),"\n","	","file_dialog_start_handler assigned: ",("function"==typeof this.settings.file_dialog_start_handler).toString(),"\n","	","file_queued_handler assigned:       ",("function"==typeof this.settings.file_queued_handler).toString(),"\n","	","file_queue_error_handler assigned:  ",("function"==typeof this.settings.file_queue_error_handler).toString(),"\n","	","upload_start_handler assigned:      ",("function"==typeof this.settings.upload_start_handler).toString(),"\n","	","upload_progress_handler assigned:   ",("function"==typeof this.settings.upload_progress_handler).toString(),"\n","	","upload_error_handler assigned:      ",("function"==typeof this.settings.upload_error_handler).toString(),"\n","	","upload_success_handler assigned:    ",("function"==typeof this.settings.upload_success_handler).toString(),"\n","	","upload_complete_handler assigned:   ",("function"==typeof this.settings.upload_complete_handler).toString(),"\n","	","debug_handler assigned:             ",("function"==typeof this.settings.debug_handler).toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(e,t,i){return void 0==t?this.settings[e]=i:this.settings[e]=t},SWFUpload.prototype.getSetting=function(e){return void 0!=this.settings[e]?this.settings[e]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return void 0!=returnValue&&"object"==typeof returnValue.post&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])},SWFUpload.prototype.cancelUpload=function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])},SWFUpload.prototype.getFile=function(e){return"number"==typeof e?this.callFlash("GetFileByIndex",[e]):this.callFlash("GetFile",[e])},SWFUpload.prototype.addFileParam=function(e,t,i){return this.callFlash("AddFileParam",[e,t,i])},SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])},SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},SWFUpload.prototype.setPostParams=function(e){this.settings.post_params=e,this.callFlash("SetPostParams",[e])},SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e,this.settings.file_types_description=t,this.callFlash("SetFileTypes",[e,t])},SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e,this.callFlash("SetFileSizeLimit",[e])},SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e,this.callFlash("SetFileUploadLimit",[e])},SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e,this.callFlash("SetFileQueueLimit",[e])},SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e,this.callFlash("SetFilePostName",[e])},SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e,this.callFlash("SetUseQueryString",[e])},SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e,this.callFlash("SetRequeueOnError",[e])},SWFUpload.prototype.setHTTPSuccess=function(e){"string"==typeof e&&(e=e.replace(" ","").split(",")),this.settings.http_success=e,this.callFlash("SetHTTPSuccess",[e])},SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e,this.callFlash("SetAssumeSuccessTimeout",[e])},SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e,this.callFlash("SetDebugEnabled",[e])},SWFUpload.prototype.setButtonImageURL=function(e){void 0==e&&(e=""),this.settings.button_image_url=e,this.callFlash("SetButtonImageURL",[e])},SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e,this.settings.button_height=t;var i=this.getMovieElement();void 0!=i&&(i.style.width=e+"px",i.style.height=t+"px"),this.callFlash("SetButtonDimensions",[e,t])},SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e,this.callFlash("SetButtonText",[e])},SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t,this.settings.button_text_left_padding=e,this.callFlash("SetButtonTextPadding",[e,t])},SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e,this.callFlash("SetButtonTextStyle",[e])},SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e,this.callFlash("SetButtonDisabled",[e])},SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e,this.callFlash("SetButtonAction",[e])},SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e,this.callFlash("SetButtonCursor",[e])},SWFUpload.prototype.queueEvent=function(e,t){void 0==t?t=[]:t instanceof Array||(t=[t]);var i=this;if("function"==typeof this.settings[e])this.eventQueue.push(function(){this.settings[e].apply(this,t)}),setTimeout(function(){i.executeNextEvent()},0);else if(null!==this.settings[e])throw"Event handler "+e+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;"function"==typeof e&&e.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(e){var t,i=/[$]([0-9a-f]{4})/i,a={};if(void 0!=e){for(var n in e.post)if(e.post.hasOwnProperty(n)){t=n;for(var s;null!==(s=i.exec(t));)t=t.replace(s[0],String.fromCharCode(parseInt("0x"+s[1],16)));a[t]=e.post[n]}e.post=a}return e},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return!1}},SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();return e?(this.cleanUp(e),void this.queueEvent("swfupload_loaded_handler")):void this.debug("Flash called back ready but the flash movie can't be found.")},SWFUpload.prototype.cleanUp=function(e){try{if(this.movieElement&&"unknown"==typeof e.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e)try{"function"==typeof e[t]&&(e[t]=null)}catch(i){}}}catch(a){}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(i){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},SWFUpload.prototype.fileQueueError=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,i])},SWFUpload.prototype.fileDialogComplete=function(e,t,i){this.queueEvent("file_dialog_complete_handler",[e,t,i])},SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},SWFUpload.prototype.returnUploadStart=function(e){var t;if("function"==typeof this.settings.upload_start_handler)e=this.unescapeFilePostParams(e),t=this.settings.upload_start_handler.call(this,e);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===t&&(t=!0),t=!!t,this.callFlash("ReturnUploadStart",[t])},SWFUpload.prototype.uploadProgress=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,i])},SWFUpload.prototype.uploadError=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,i])},SWFUpload.prototype.uploadSuccess=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t,i])},SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)},SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,i=[];if("object"==typeof e&&"string"==typeof e.name&&"string"==typeof e.message){for(var a in e)e.hasOwnProperty(a)&&i.push(a+": "+e[a]);t=i.join("\n")||"",i=t.split("\n"),t="EXCEPTION: "+i.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else SWFUpload.Console.writeLine(e)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(e){var t,i;try{t=document.getElementById("SWFUpload_Console"),t||(i=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(i),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",i.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(a){alert("Exception: "+a.name+" Message: "+a.message)}};var $=require("jquery"),methods={init:function(e,t){return this.each(function(){var i=$(this),a=i.clone(),n=$.extend({id:i.attr("id"),swf:"uploadify.swf",uploader:"uploadify.php",auto:!0,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:!1,debug:!1,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",height:30,itemTemplate:!1,method:"post",multi:!0,formData:{},preventCaching:!0,progressData:"percentage",queueID:!1,queueSizeLimit:999,removeCompleted:!0,removeTimeout:3,requeueErrors:!1,successTimeout:30,uploadLimit:0,width:120,overrideEvents:[]},e),s={assume_success_timeout:n.successTimeout,button_placeholder_id:n.id,button_width:n.width,button_height:n.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:n.multi?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE,button_disabled:!1,button_cursor:"arrow"==n.buttonCursor?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,debug:n.debug,requeue_on_error:n.requeueErrors,file_post_name:n.fileObjName,file_size_limit:n.fileSizeLimit,file_types:n.fileTypeExts,file_types_description:n.fileTypeDesc,file_queue_limit:n.queueSizeLimit,file_upload_limit:n.uploadLimit,flash_url:n.swf,prevent_swf_caching:n.preventCaching,post_params:n.formData,upload_url:n.uploader,use_query_string:"get"==n.method,file_dialog_complete_handler:handlers.onDialogClose,file_dialog_start_handler:handlers.onDialogOpen,file_queued_handler:handlers.onSelect,file_queue_error_handler:handlers.onSelectError,swfupload_loaded_handler:n.onSWFReady,upload_complete_handler:handlers.onUploadComplete,upload_error_handler:handlers.onUploadError,upload_progress_handler:handlers.onUploadProgress,upload_start_handler:handlers.onUploadStart,upload_success_handler:handlers.onUploadSuccess};t&&(s=$.extend(s,t)),s=$.extend(s,n);var o=swfobject.getFlashPlayerVersion(),r=o.major>=9;if(r){window["uploadify_"+n.id]=new SWFUpload(s);var u=window["uploadify_"+n.id];i.data("uploadify",u);var l=$("<div />",{id:n.id,"class":"uploadify",css:{height:n.height+"px",width:n.width+"px"}});$("#"+u.movieName).wrap(l),l=$("#"+n.id),l.data("uploadify",u);var d=$("<div />",{id:n.id+"-button","class":"uploadify-button "+n.buttonClass});if(n.buttonImage&&d.css({"background-image":"url('"+n.buttonImage+"')","text-indent":"-9999px"}),d.html('<span class="uploadify-button-text">'+n.buttonText+"</span>").css({height:n.height+"px","line-height":n.height+"px",width:n.width+"px"}),l.append(d),!n.queueID){var p=$("<div />",{id:n.id+"-queue","class":"uploadify-queue"});l.after(p),u.settings.queueID=n.id+"-queue",u.settings.defaultQueue=!0}u.queueData={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,uploadsSuccessful:0,uploadsErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"Some files were not added to the queue:"},u.original=a,u.wrapper=l,u.button=d,u.queue=p,n.onInit&&n.onInit.call(i,u)}else n.onFallback&&n.onFallback.call(i)})},cancel:function(e,t){var i=arguments;this.each(function(){var e=$(this),t=e.data("uploadify"),a=t.settings,n=-1;if(i[0])if("*"==i[0]){var s=t.queueData.queueLength;$("#"+a.queueID).find(".uploadify-queue-item").each(function(){n++,i[1]===!0?t.cancelUpload($(this).attr("id"),!1):t.cancelUpload($(this).attr("id")),$(this).find(".data").removeClass("data").html(" - Cancelled"),$(this).find(".uploadify-progress-bar").remove(),$(this).delay(1e3+100*n).fadeOut(500,function(){$(this).remove()})}),t.queueData.queueSize=0,t.queueData.queueLength=0,a.onClearQueue&&a.onClearQueue.call(e,s)}else for(var o=0;o<i.length;o++)t.cancelUpload(i[o]),$("#"+i[o]).find(".data").removeClass("data").html(" - Cancelled"),$("#"+i[o]).find(".uploadify-progress-bar").remove(),$("#"+i[o]).delay(1e3+100*o).fadeOut(500,function(){$(this).remove()});else{var r=$("#"+a.queueID).find(".uploadify-queue-item").get(0);$item=$(r),t.cancelUpload($item.attr("id")),$item.find(".data").removeClass("data").html(" - Cancelled"),$item.find(".uploadify-progress-bar").remove(),$item.delay(1e3).fadeOut(500,function(){$(this).remove()})}})},destroy:function(){this.each(function(){var e=$(this),t=e.data("uploadify"),i=t.settings;t.destroy(),i.defaultQueue&&$("#"+i.queueID).remove(),$("#"+i.id).replaceWith(t.original),i.onDestroy&&i.onDestroy.call(this),delete t})},disable:function(e){this.each(function(){var t=$(this),i=t.data("uploadify"),a=i.settings;e?(i.button.addClass("disabled"),a.onDisable&&a.onDisable.call(this)):(i.button.removeClass("disabled"),a.onEnable&&a.onEnable.call(this)),i.setButtonDisabled(e)})},settings:function(e,t,i){var a=arguments,n=t;return this.each(function(){var s=$(this),o=s.data("uploadify"),r=o.settings;if("object"==typeof a[0])for(var u in t)setData(u,t[u]);if(1===a.length)n=r[e];else{switch(e){case"uploader":o.setUploadURL(t);break;case"formData":i||(t=$.extend(r.formData,t)),o.setPostParams(r.formData);break;case"method":"get"==t?o.setUseQueryString(!0):o.setUseQueryString(!1);break;case"fileObjName":o.setFilePostName(t);break;case"fileTypeExts":o.setFileTypes(t,r.fileTypeDesc);break;case"fileTypeDesc":o.setFileTypes(r.fileTypeExts,t);break;case"fileSizeLimit":o.setFileSizeLimit(t);break;case"uploadLimit":o.setFileUploadLimit(t);break;case"queueSizeLimit":o.setFileQueueLimit(t);break;case"buttonImage":o.button.css("background-image",settingValue);break;case"buttonCursor":"arrow"==t?o.setButtonCursor(SWFUpload.CURSOR.ARROW):o.setButtonCursor(SWFUpload.CURSOR.HAND);break;case"buttonText":$("#"+r.id+"-button").find(".uploadify-button-text").html(t);break;case"width":o.setButtonDimensions(t,r.height);break;case"height":o.setButtonDimensions(r.width,t);break;case"multi":t?o.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILES):o.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILE)}r[e]=t}}),1===a.length?n:void 0},stop:function(){this.each(function(){var e=$(this),t=e.data("uploadify");t.queueData.averageSpeed=0,t.queueData.uploadSize=0,t.queueData.bytesUploaded=0,t.queueData.uploadQueue=[],t.stopUpload()})},upload:function(){var e=arguments;this.each(function(){var t=$(this),i=t.data("uploadify");if(i.queueData.averageSpeed=0,i.queueData.uploadSize=0,i.queueData.bytesUploaded=0,i.queueData.uploadQueue=[],e[0])if("*"==e[0])i.queueData.uploadSize=i.queueData.queueSize,i.queueData.uploadQueue.push("*"),i.startUpload();else{for(var a=0;a<e.length;a++)i.queueData.uploadSize+=i.queueData.files[e[a]].size,i.queueData.uploadQueue.push(e[a]);i.startUpload(i.queueData.uploadQueue.shift())}else i.startUpload()})}},handlers={onDialogOpen:function(){var e=this.settings;this.queueData.errorMsg="Some files were not added to the queue:",this.queueData.filesReplaced=0,this.queueData.filesCancelled=0,e.onDialogOpen&&e.onDialogOpen.call(this)},onDialogClose:function(e,t,i){var a=this.settings;this.queueData.filesErrored=e-t,this.queueData.filesSelected=e,this.queueData.filesQueued=t-this.queueData.filesCancelled,this.queueData.queueLength=i,$.inArray("onDialogClose",a.overrideEvents)<0&&this.queueData.filesErrored>0&&alert(this.queueData.errorMsg),a.onDialogClose&&a.onDialogClose.call(this,this.queueData),a.auto&&$("#"+a.id).uploadify("upload","*")},onSelect:function(e){var t=this.settings,i={};for(var a in this.queueData.files)if(i=this.queueData.files[a],1!=i.uploaded&&i.name==e.name){var n=confirm('The file named "'+e.name+'" is already in the queue.\nDo you want to replace the existing item in the queue?');if(!n)return this.cancelUpload(e.id),this.queueData.filesCancelled++,!1;$("#"+i.id).remove(),this.cancelUpload(i.id),this.queueData.filesReplaced++}var s=Math.round(e.size/1024),o="KB";s>1e3&&(s=Math.round(s/1e3),o="MB");var r=s.toString().split(".");s=r[0],r.length>1&&(s+="."+r[1].substr(0,2)),s+=o;var u=e.name;if(u.length>25&&(u=u.substr(0,25)+"..."),itemData={fileID:e.id,instanceID:t.id,fileName:u,fileSize:s},0==t.itemTemplate&&(t.itemTemplate='<div id="${fileID}" class="uploadify-queue-item">          <div class="cancel">            <a href="javascript:$(\'#${instanceID}\').uploadify(\'cancel\', \'${fileID}\')">X</a>          </div>          <span class="fileName">${fileName} (${fileSize})</span><span class="data"></span>          <div class="uploadify-progress">            <div class="uploadify-progress-bar"><!--Progress Bar--></div>          </div>        </div>'),$.inArray("onSelect",t.overrideEvents)<0){itemHTML=t.itemTemplate;for(var l in itemData)itemHTML=itemHTML.replace(new RegExp("\\$\\{"+l+"\\}","g"),itemData[l]);$("#"+t.queueID).append(itemHTML)}this.queueData.queueSize+=e.size,this.queueData.files[e.id]=e,t.onSelect&&t.onSelect.apply(this,arguments)},onSelectError:function(e,t,i){var a=this.settings;if($.inArray("onSelectError",a.overrideEvents)<0)switch(t){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:a.queueSizeLimit>i?this.queueData.errorMsg+="\nThe number of files selected exceeds the remaining upload limit ("+i+").":this.queueData.errorMsg+="\nThe number of files selected exceeds the queue size limit ("+a.queueSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+e.name+'" exceeds the size limit ('+a.fileSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.queueData.errorMsg+='\nThe file "'+e.name+'" is empty.';break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+e.name+'" is not an accepted file type ('+a.fileTypeDesc+")."}t!=SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&delete this.queueData.files[e.id],a.onSelectError&&a.onSelectError.apply(this,arguments)},onQueueComplete:function(){this.settings.onQueueComplete&&this.settings.onQueueComplete.call(this,this.settings.queueData)},onUploadComplete:function(e){var t=this.settings,i=this,a=this.getStats();if(this.queueData.queueLength=a.files_queued,"*"==this.queueData.uploadQueue[0]?this.queueData.queueLength>0?this.startUpload():(this.queueData.uploadQueue=[],t.onQueueComplete&&t.onQueueComplete.call(this,this.queueData)):this.queueData.uploadQueue.length>0?this.startUpload(this.queueData.uploadQueue.shift()):(this.queueData.uploadQueue=[],t.onQueueComplete&&t.onQueueComplete.call(this,this.queueData)),$.inArray("onUploadComplete",t.overrideEvents)<0)if(t.removeCompleted)switch(e.filestatus){case SWFUpload.FILE_STATUS.COMPLETE:setTimeout(function(){$("#"+e.id)&&(i.queueData.queueSize-=e.size,i.queueData.queueLength-=1,delete i.queueData.files[e.id],$("#"+e.id).fadeOut(500,function(){$(this).remove()}))},1e3*t.removeTimeout);break;case SWFUpload.FILE_STATUS.ERROR:t.requeueErrors||setTimeout(function(){$("#"+e.id)&&(i.queueData.queueSize-=e.size,i.queueData.queueLength-=1,delete i.queueData.files[e.id],$("#"+e.id).fadeOut(500,function(){$(this).remove()}))},1e3*t.removeTimeout)}else e.uploaded=!0;t.onUploadComplete&&t.onUploadComplete.call(this,e)},onUploadError:function(e,t,i){var a=this.settings,n="Error";switch(t){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:n="HTTP Error ("+i+")";break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:n="Missing Upload URL";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:n="IO Error";break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:
    n="Security Error";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:alert("The upload limit has been reached ("+i+")."),n="Exceeds Upload Limit";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:n="Failed";break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:n="Validation Error";break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:n="Cancelled",this.queueData.queueSize-=e.size,this.queueData.queueLength-=1,(e.status==SWFUpload.FILE_STATUS.IN_PROGRESS||$.inArray(e.id,this.queueData.uploadQueue)>=0)&&(this.queueData.uploadSize-=e.size),a.onCancel&&a.onCancel.call(this,e),delete this.queueData.files[e.id];break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:n="Stopped"}$.inArray("onUploadError",a.overrideEvents)<0&&(t!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&t!=SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED&&$("#"+e.id).addClass("uploadify-error"),$("#"+e.id).find(".uploadify-progress-bar").css("width","1px"),t!=SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&e.status!=SWFUpload.FILE_STATUS.COMPLETE&&$("#"+e.id).find(".data").html(" - "+n));var s=this.getStats();this.queueData.uploadsErrored=s.upload_errors,a.onUploadError&&a.onUploadError.call(this,e,t,i,n)},onUploadProgress:function(e,t,i){var a=this.settings,n=new Date,s=n.getTime(),o=s-this.timer;o>500&&(this.timer=s);var r=t-this.bytesLoaded;this.bytesLoaded=t;var u=this.queueData.queueBytesUploaded+t,l=Math.round(t/i*100),d="KB/s",p=0,c=r/1024/(o/1e3);c=Math.floor(10*c)/10,this.queueData.averageSpeed>0?this.queueData.averageSpeed=Math.floor((this.queueData.averageSpeed+c)/2):this.queueData.averageSpeed=Math.floor(c),c>1e3&&(p=.001*c,this.queueData.averageSpeed=Math.floor(p),d="MB/s"),$.inArray("onUploadProgress",a.overrideEvents)<0&&("percentage"==a.progressData?$("#"+e.id).find(".data").html(" - "+l+"%"):"speed"==a.progressData&&o>500&&$("#"+e.id).find(".data").html(" - "+this.queueData.averageSpeed+d),$("#"+e.id).find(".uploadify-progress-bar").css("width",l+"%")),a.onUploadProgress&&a.onUploadProgress.call(this,e,t,i,u,this.queueData.uploadSize)},onUploadStart:function(e){var t=this.settings,i=new Date;this.timer=i.getTime(),this.bytesLoaded=0,0==this.queueData.uploadQueue.length&&(this.queueData.uploadSize=e.size),t.checkExisting&&$.ajax({type:"POST",async:!1,url:t.checkExisting,data:{filename:e.name},success:function(t){if(1==t){var i=confirm('A file with the name "'+e.name+'" already exists on the server.\nWould you like to replace the existing file?');i||(this.cancelUpload(e.id),$("#"+e.id).remove(),this.queueData.uploadQueue.length>0&&this.queueData.queueLength>0&&("*"==this.queueData.uploadQueue[0]?this.startUpload():this.startUpload(this.queueData.uploadQueue.shift())))}}}),t.onUploadStart&&t.onUploadStart.call(this,e)},onUploadSuccess:function(e,t,i){var a=this.settings,n=this.getStats();this.queueData.uploadsSuccessful=n.successful_uploads,this.queueData.queueBytesUploaded+=e.size,$.inArray("onUploadSuccess",a.overrideEvents)<0&&$("#"+e.id).find(".data").html(" - Complete"),a.onUploadSuccess&&a.onUploadSuccess.call(this,e,t,i)}};$.fn.uploadify=function(e){return methods[e]?methods[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void $.error("The method "+e+" does not exist in $.uploadify"):methods.init.apply(this,arguments)},window.SWFUpload=SWFUpload,window.swfobject=swfobject,module.exports=methods}),define("bui/uploader/type/uploadify",["jquery","bui/common"],function(e,t,i){function a(e){var t=this;a.superclass.constructor.call(t,e)}var n=e("jquery"),s=e("bui/uploader/file"),o=e("bui/uploader/type/base"),r=new RegExp("^([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),u=new RegExp("^(?:([\\w\\d+.-]+):)?(?://([\\w\\d\\-\\u0100-\\uffff.+%]*))?.*$");BUI.extend(a,o,{_init:function(){var e=this,t=e.get("swfButton"),i=t.get("uploadifyEl"),a=i.uploadify({auto:!1,width:200,height:200,swf:t.get("flashUrl"),uploader:e.get("url"),onSelect:function(e){var i=[];i.push(s.create(e)),t.fire("change",{files:i})},onUploadStart:function(t){e.fire("start",{file:s.create(t)})},onUploadProgress:function(t,i,a,n,s){e.fire("progress",{loaded:i,total:a})},onUploadSuccess:function(t,i,a){var n=e._processResponse(i);t=s.create(t),e.fire("complete",{result:n,file:t})},onUploadError:function(t){e.fire("error",{file:s.create(t)})}});e.set("uploadify",a)},upload:function(){var e=this,t=e.get("swfButton"),i=t.get("uploadifyEl");return i.uploadify("upload","*"),e},cancel:function(){var e=this,t=e.get("swfButton"),i=t.get("uploadifyEl");return i.uploadify("cancel","*"),e},_hasCrossdomain:function(){var e=this,t=e.get("url").match(u)||[],i=e.get("swfUploader").get("src").match(u)||[],a=t[2],s=i[2];a&&s&&a!==s&&n.ajax({url:t[1]+"://"+a+"/crossdomain.xml",dataType:"xml",error:function(){BUI.log("\u7f3a\u5c11crossdomain.xml\u6587\u4ef6\u6216\u8be5\u6587\u4ef6\u4e0d\u5408\u6cd5\uff01")}})}},{ATTRS:{uploader:{setter:function(e){var t=this;if(e&&e.isController){var i=e.get("button");t.set("swfButton",i),t._init()}}},url:{setter:function(e){var t=/^http/;if(!t.test(e)){var i,a=location.href.match(r)||[],n=a[1]||"",s=n.split("/");i=BUI.Array.filter(s,function(e,t){return t<s.length-1}),e=i.join("/")+"/"+e}return e}},uploadingId:{},events:{value:{progress:!1}}}}),i.exports=a}),define("bui/uploader/validator",["jquery","bui/common"],function(e,t,i){function a(e){a.superclass.constructor.call(this,e)}var n=e("jquery"),s=e("bui/common");a.ATTRS={rules:{},queue:{}},s.extend(a,s.Base),s.augment(a,{valid:function(e){return this._validItem(e)},_validItem:function(e){var t=this,i=t.get("rules"),a=!0;return s.each(i,function(i,n){return a=a&&t._validRule(e,n,i)}),a},_validRule:function(e,t,i,n){s.isArray(i)&&(n=s.substitute(i[1],i),i=i[0]);var o=a.getRule(t),r=o&&o.call(this,e,i,n),u=this._getResult(r);return u?(e.result=u,!1):!0},_getResult:function(e){return e?{msg:e}:void 0}});var o={};a.addRule=function(e,t){o[e]=t},a.getRule=function(e){return o[e]},a.addRule("maxSize",function(e,t,i){return e.size>1024*t?i:void 0}),a.addRule("minSize",function(e,t,i){return e.size<1024*t?i:void 0}),a.addRule("max",function(e,t,i){var a=this.get("queue").getCount();return a>t?i:void 0}),a.addRule("min",function(e,t,i){var a=this.get("queue").getCount();return t>a?i:void 0}),a.addRule("ext",function(e,t,i){var a=e.ext,t=t.split(",");return-1===n.inArray(a,t)?i:void 0}),i.exports=a});